<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Love - Poetry App</title>
<style>
/* === GLOBAL STYLES === */
body {
  margin: 0;
  padding: 0;
  background: #0b0b10;
  font-family: system-ui, sans-serif;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -webkit-overflow-scrolling: touch;
}

.scroller {
  height: 100vh;
  overflow-y: auto;
  scroll-behavior: smooth;
  padding: 7rem 2rem 1rem 2rem;
  display: flex;
  gap: 2rem;
  box-sizing: border-box;
  perspective: 1px; /* smooth 3d transforms */
}

.column {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  flex: 1;
  will-change: transform;
}

.card img {
  width: 100%;
  height: 15rem;
  border-radius: 16px;
  object-fit: cover;
  display: block;
  cursor: pointer;
  will-change: transform;
  backface-visibility: hidden;
}

/* HEADER / SELF-DRAW TEXT */
.header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100px;
  z-index: 1000;
  pointer-events: none;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: transform 0.5s ease, opacity 0.5s ease;
  will-change: transform, opacity;
}
.header.hidden {
  transform: translateY(-120%);
  opacity: 0;
}
.self-draw-text {
  width: 100%;
  height: 100px;
}
.self-draw-text text {
  fill: none;
  stroke: #fd709e;
  stroke-width: 2;
  stroke-dasharray: 600;
  stroke-dashoffset: 600;
  animation: draw 3s linear forwards;
  font-size: 72px;
  font-family: "Love Light", cursive;
  text-anchor: middle;
  dominant-baseline: middle;
  will-change: stroke-dashoffset;
}
@keyframes draw { to { stroke-dashoffset: 0; } }

/* MODAL */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: rgba(0,0,0,0);
  opacity: 0;
  transition: background 0.5s ease, opacity 0.5s ease;
  will-change: opacity;
}
.modal.show { opacity: 1; background: rgba(0,0,0,0.8); }
.modal-content {
  color: #fff;
  position: absolute;
  background: #111111c2;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: start;
  border-radius: 12px;
  opacity: 0;
  transform: translate3d(0,0,0) scale(0.8);
  transition: transform 0.5s cubic-bezier(0.4,0,0.2,1), opacity 0.5s ease, border-radius 0.5s ease;
  will-change: transform, opacity;
}
.modal-content.show { opacity: 1; transform: translate3d(0,0,0) scale(1); }
.closeBtn {
  position: absolute;
  top: 1rem;
  right: 1rem;
  cursor: pointer;
  font-size: 2rem;
  color: #fff;
  z-index: 1010;
}
body.modal-open { overflow: hidden; }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <svg viewBox="0 0 600 100" class="self-draw-text">
    <text x="50%" y="50%">1/22/26</text>
  </svg>
</div>

<!-- SCROLLER / GRID -->
<div id="scroller" class="scroller"></div>

<!-- MODAL -->
<div id="imageModal" class="modal">
  <div class="modal-content">
    <span class="closeBtn">&times;</span>
    <h2 id="poemTitle"></h2>
    <p id="poemText"></p>
    <h4>Why this poem?</h4>
    <p id="poemExplain"></p>
  </div>
</div>

<script>
const scroller = document.getElementById("scroller");
const header = document.querySelector(".header");
const MAX_STAGGER = 50;
let poems = [];
const columns = [];

// MODAL
const modal = document.getElementById("imageModal");
const modalContent = modal.querySelector(".modal-content");
const poemTitle = document.getElementById("poemTitle");
const poemText = document.getElementById("poemText");
const poemExplain = document.getElementById("poemExplain");
const closeBtn = modal.querySelector(".closeBtn");
let lastImageRect;

// HELPER FUNCTIONS
function getColumnCount() {
  const w = window.innerWidth;
  if (w < 600) return 2;
  if (w < 900) return 3;
  if (w < 1200) return 4;
  return 5;
}

function createColumns() {
  const colCount = getColumnCount();
  scroller.innerHTML = "";
  columns.length = 0;
  for (let i=0;i<colCount;i++){
    const col = document.createElement("div");
    col.className = "column";
    columns.push(col);
    scroller.appendChild(col);
  }
}

function distributeCards() {
  if(!poems.length) return;
  columns.forEach(c=>c.innerHTML="");
  poems.forEach((p,i)=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`<img src="${p.img}" data-title="${p.title}" data-text="${p.text}" data-explain="${p.explain}">`;
    card.querySelector("img").addEventListener("click", e=>openModal(p,e.target));
    columns[i%columns.length].appendChild(card);
  });
}

function applyStagger(fraction){
  columns.forEach((c,i)=>{
    const offset = (1-fraction)*MAX_STAGGER*(i%2);
    c.style.transform=`translate3d(0,${offset}px,0)`;
  });
}

// === SMOOTH SCROLL WITH RAF ===
let lastScroll=0;
function onScroll(){
  const scrollTop = scroller.scrollTop;
  const scrollHeight = scroller.scrollHeight - scroller.clientHeight;
  const fraction = Math.min(Math.max(scrollTop/scrollHeight,0),1);
  applyStagger(fraction);

  if(scrollTop >0) header.classList.add("hidden");
  else header.classList.remove("hidden");

  lastScroll=scrollTop;
  requestAnimationFrame(onScroll);
}

// === MODAL ===
function openModal(data,imgEl){
  if(!imgEl) return;
  document.body.classList.add("modal-open");
  lastImageRect = imgEl.getBoundingClientRect();
  modalContent.style.transform=`translate3d(${lastImageRect.left+lastImageRect.width/2-window.innerWidth/2}px,${lastImageRect.top+lastImageRect.height/2-window.innerHeight/2}px,0) scale(${lastImageRect.width/window.innerWidth},${lastImageRect.height/window.innerHeight})`;
  modalContent.style.borderRadius="50%";
  modalContent.style.opacity="0";
  poemTitle.textContent=data.title;
  poemText.textContent=data.text;
  poemExplain.textContent=data.explain;
  modal.style.display="block";
  requestAnimationFrame(()=>{
    modal.classList.add("show");
    modalContent.classList.add("show");
    modalContent.style.transform="translate3d(0,0,0) scale(1)";
    modalContent.style.borderRadius="12px";
    modalContent.style.opacity="1";
  });
}

function closeModal(){
  if(!lastImageRect) return;
  modalContent.style.opacity="0";
  modalContent.style.transform=`translate3d(${lastImageRect.left+lastImageRect.width/2-window.innerWidth/2}px,${lastImageRect.top+lastImageRect.height/2-window.innerHeight/2}px,0) scale(${lastImageRect.width/window.innerWidth},${lastImageRect.height/window.innerHeight})`;
  modalContent.style.borderRadius="50%";
  modal.classList.remove("show");
  modalContent.addEventListener("transitionend",()=>{
    modal.style.display="none";
    document.body.classList.remove("modal-open");
  },{once:true});
}

closeBtn.addEventListener("click",closeModal);

// === LOAD POEMS ===
fetch("poems.json").then(r=>r.json()).then(data=>{
  poems=data;
  createColumns();
  distributeCards();
  applyStagger(0);
});

// INITIALIZE
requestAnimationFrame(onScroll);
window.addEventListener("resize",()=>{
  createColumns();
  distributeCards();
  applyStagger(0);
});
</script>
</body>
</html>
